---
import Hamburger from "./Hamburger.astro";
import Navigation from "./Navigation.astro";
---

<header class="site-header">
    <nav class="site-nav" aria-label="Primary">
        <a class="site-brand" href="/">Truls Henrik</a>
        <Hamburger controlsId="primary-nav" />
        <Navigation />
    </nav>

    <script>
        function init() {
            const button = document.querySelector(
                ".hamburger"
            ) as HTMLButtonElement | null;
            const navLinks = document.querySelector(
                ".nav-links"
            ) as HTMLElement | null;
            const win = window as Window & { __navResizeBound?: boolean };

            if (!button || !navLinks) return;
            if (button.dataset.bound === "true") return;

            button.dataset.bound = "true";

            const setExpanded = (isOpen: boolean) => {
                button.setAttribute("aria-expanded", isOpen ? "true" : "false");
            };

            const closeMenu = () => {
                navLinks.classList.remove("is-open");
                setExpanded(false);
            };

            button.addEventListener("click", () => {
                const isOpen = navLinks.classList.toggle("is-open");
                setExpanded(isOpen);
            });

            navLinks.querySelectorAll("a").forEach((link) => {
                link.addEventListener("click", closeMenu);
            });

            if (!win.__navResizeBound) {
                window.addEventListener("resize", () => {
                    if (window.innerWidth >= 760) {
                        closeMenu();
                    }
                });
                win.__navResizeBound = true;
            }
        }

        init();
        document.addEventListener("astro:after-swap", init);
    </script>

    <style>
        .site-header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: linear-gradient(
                180deg,
                color-mix(in oklch, var(--surface-strong) 96%, var(--bright-ocean))
                    0%,
                color-mix(in oklch, var(--surface) 92%, var(--saffron)) 100%
            );
            backdrop-filter: blur(8px);
            border-bottom: 2px solid var(--border-strong);
            box-shadow: inset 0 1px 0 white;
        }

        .site-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            max-width: 1100px;
            margin: 0 auto;
            padding: 0.8rem clamp(1rem, 3vw, 1.8rem);
            position: relative;
        }

        .site-brand {
            font-family: var(--font-display);
            font-size: clamp(1.2rem, 2.6vw, 1.7rem);
            letter-spacing: 0.02em;
            text-transform: none;
            color: var(--ink);
            text-decoration: none;
            text-shadow:
                1px 1px 0 color-mix(in oklch, var(--saffron) 74%, white),
                2px 2px 0 color-mix(in oklch, var(--accent) 14%, transparent);
        }

        .site-brand:hover {
            color: var(--accent);
        }
    </style>
</header>
