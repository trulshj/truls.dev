---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";

const allPosts = (await getCollection("posts"))
    .filter((x) => !x.data.isDraft)
    .sort(
        (a, b) =>
            (b.data.pubDate as Date).valueOf() -
            (a.data.pubDate as Date).valueOf(),
    );

const pageTitle = "Truls Henrik";

const talks = (await getCollection("talks")).sort(
    (a, b) => (b.data.date as Date).valueOf() - (a.data.date as Date).valueOf(),
);

const talkEntries = await Promise.all(
    talks.map(async (talk) => ({
        ...talk,
        Content: (await talk.render()).Content,
    })),
);

---

<BaseLayout pageTitle={pageTitle} windowTitle="hjemmeside.exe">
    <section class="hero">
        <div class="stack reveal">
            <h1>Truls Henrik</h1>
            <p class="lead">
                Jeg liker når ting gir mening. Helst for flere enn bare meg. Her
                samler jeg skriverier om visualisering, programmering og
                matematikk, med et mykt fokus på formidling og systemer som gjør
                ting lettere å forstå.
            </p>
        </div>
    </section>

    <section class="section" id="writing">
        <div class="stack reveal">
            <h2>Siste innlegg</h2>
            <p class="muted">
                Skriverier om visualisering, programmering og matte, med et
                menneskelig perspektiv.
            </p>
        </div>
        {
            allPosts.length ? (
                <ul class="list">
                    {allPosts.map((post) => (
                        <li transition:name={post.data.title}>
                            <a class="list-item list-item--link" href={`/blog/${post.slug}`}>
                                <h3>{post.data.title}</h3>
                                {post.data.excerpt && (
                                    <p class="muted">{post.data.excerpt}</p>
                                )}
                                <span class="muted">
                                    {(post.data.pubDate as Date).toLocaleDateString(
                                        "nb",
                                        {
                                            day: "2-digit",
                                            month: "long",
                                            year: "numeric",
                                        },
                                    )}
                                </span>
                            </a>
                        </li>
                    ))}
                </ul>
            ) : (
                <div class="card reveal">
                    <h3>Ingen publiserte innlegg ennå</h3>
                    <p>
                        Jeg jobber med å fylle på. Kom gjerne tilbake snart,
                        eller{" "}
                        <a class="inline-link" href="mailto:post@truls.dev">
                            si hei på e-post
                        </a>
                        om du er nysgjerrig.
                    </p>
                </div>
            )
        }
    </section>

    <section class="section" id="talks">
        <div class="stack reveal">
            <h2>Videoer og foredrag</h2>
            <!-- <p class="muted">Et lite utvalg av opptak.</p> -->
        </div>
        <ul class="list">
            {
                talkEntries.map((talk) => (
                    <li class="list-item reveal">
                        <h3>{talk.data.title}</h3>
                        <div class="muted">
                            <talk.Content />
                        </div>
                        <div class="stack">
                            {talk.data.links.map(
                                (link: { label: string; href: string }) => (
                                    <a href={link.href}>{link.label}</a>
                                ),
                            )}
                        </div>
                    </li>
                ))
            }
        </ul>
    </section>

</BaseLayout>
